        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>ProgressControler class / asset_pack Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="asset_pack" data-type="ProgressControler">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../asset_pack.html">asset_pack</a> &rsaquo; <a href="../asset_pack/ProgressControler.html">ProgressControler</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>ProgressControler</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>A <a class="crossref" href="../asset_pack/ProgressControler.html#ProgressControler">ProgressControler</a> to bind a <code>Stream</code>&lt;<a class="crossref" href="../asset_pack/AssetPackTraceEvent.html">AssetPackTraceEvent</a>> to an
html <code>ProgressElement.value</code> or <code>Element.style.width</code>.</p>
<p>The <code>Stream</code>&lt;<a class="crossref" href="../asset_pack/AssetPackTraceEvent.html">AssetPackTraceEvent</a>> can be provide by
<a class="crossref" href="../asset_pack/AssetPackTrace.html#asStream">AssetPackTrace.asStream()</a>.</p>
<p>   var bar = query("#assetProgressTestAssets");
   var log = query("#assetLogTestAssets");
   var tracer = new AssetPackTrace();
   var stream = tracer.asStream().asBroadcastStream();
   new ProgressControler(bar).bind(stream);
   new EventsPrintControler(log).bind(stream);</p><ul><li>
<p>Asset doesn't provide estimation of ready so every assets are managed
  with same weight (big file == small), a way correct
  is to use an custom <a class="crossref" href="../asset_pack/ProgressControler.html#ease">ease</a>, or simply to provide an other fealing to user.</p></li><li>
<p>The progress can go back when number of download increase,
  set <a class="crossref" href="../asset_pack/ProgressControler.html#displayBackward">displayBackward</a> = false, if you don't want do diplay it (progression
  always increase).</p></li><li>If every download are completed, next download will reset the progression.</li><li>
<p>To customise style of <code>ProgressElement</code> you can take a look at
  <a href="http://www.useragentman.com/blog/2012/01/03/cross-browser-html5-progress-bars-in-depth/">Cross Browser HTML5 Progress Bars In Depth</a></p></li><li><code>ProgressElement.max</code> define the precision of the display (eg 100, 1000).</li><li>
<p><a class="crossref" href="../asset_pack/ProgressControler.html#ProgressControler">ProgressControler</a> modify only the <code>ProgressElement.value</code> via a
  function of <code>ProgressElement.max</code>
  OR <code>Element.style.width</code> if view parameter (constructor)
  is not a <code>ProgressElement</code>.</p></li></ul>
<pre class="source">
class ProgressControler {
 static num linear(double ratio, num change, num baseValue) {
   return change * ratio + baseValue;
 }

 ProgressElement _pview;
 Element _wview;

 /// The function use to display the ratio on the progress bar
 /// default is linear, but other is allowed to display a quick start,...
 final Ease ease;

 /// The progress can go back when ratio decrease (completed/total)
 var displayBackward = true;

 var _total = 0;
 var _current = 0;
 var _ratio = 0.0;

 ProgressControler(Element view, {
   Ease this.ease : linear,
   this.displayBackward : true
 }) {
   if (view is ProgressElement) {
     _pview = view;
   } else {
     _wview = view;
   }
 }

 StreamSubscription bind(Stream&lt;AssetPackTraceEvent&gt; tracer) {
   return tracer.listen(onEvent);
 }

 void _resetCountersIfEqual() {
   if (_total == _current) {
     _total = 0;
     _current = 0;
     _ratio = 0.0;
   }
 }

 void onEvent(AssetPackTraceEvent event) {
   switch(event.type) {
     case AssetPackTraceEvent.PackImportStart:
       _resetCountersIfEqual();
       _total += 1;
       break;
     case AssetPackTraceEvent.AssetLoadStart:
       _resetCountersIfEqual();
       _total += 2; // load + import
       break;
     case AssetPackTraceEvent.AssetImportStart:
       // ignore already include in load
       break;
     case AssetPackTraceEvent.PackImportEnd:
     case AssetPackTraceEvent.AssetLoadEnd:
     case AssetPackTraceEvent.AssetImportEnd:
       _current += 1;
       break;
   }
   var n = _current/_total;
   _ratio = (displayBackward) ? n : max(_ratio, n);
   if (_pview != null) {
     _pview.value = ease(_ratio, _pview.max, 0).toInt();
   }
   if (_wview != null) {
     _wview.style.width = ease(_ratio, 100, 0).toString() +  "%";
   }
 }
}
</pre>
</div>
<div>
<h3>Static Methods</h3>
<div class="method"><h4 id="linear">
<button class="show-code">Code</button>
num <strong>linear</strong>(double ratio, num change, num baseValue) <a class="anchor-link" href="#linear"
              title="Permalink to ProgressControler.linear">#</a></h4>
<div class="doc">
<pre class="source">
static num linear(double ratio, num change, num baseValue) {
 return change * ratio + baseValue;
}
</pre>
</div>
</div>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="ProgressControler">
<button class="show-code">Code</button>
new <strong>ProgressControler</strong>(Element view, {<a href="../asset_pack/Ease.html">Ease</a> ease: linear, displayBackward: true}) <a class="anchor-link" href="#ProgressControler"
              title="Permalink to ProgressControler.ProgressControler">#</a></h4>
<div class="doc">
<pre class="source">
ProgressControler(Element view, {
 Ease this.ease : linear,
 this.displayBackward : true
}) {
 if (view is ProgressElement) {
   _pview = view;
 } else {
   _wview = view;
 }
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="displayBackward">
<button class="show-code">Code</button>
var         <strong>displayBackward</strong> <a class="anchor-link"
            href="#displayBackward"
            title="Permalink to ProgressControler.displayBackward">#</a>
        </h4>
        <div class="doc">
<p>The progress can go back when ratio decrease (completed/total)</p>
<pre class="source">
var displayBackward = true
</pre>
</div>
</div>
<div class="field"><h4 id="ease">
<button class="show-code">Code</button>
final <a href="../asset_pack/Ease.html">Ease</a>         <strong>ease</strong> <a class="anchor-link"
            href="#ease"
            title="Permalink to ProgressControler.ease">#</a>
        </h4>
        <div class="doc">
<p>The function use to display the ratio on the progress bar
default is linear, but other is allowed to display a quick start,...</p>
<pre class="source">
final Ease ease
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="bind">
<button class="show-code">Code</button>
StreamSubscription <strong>bind</strong>(Stream&lt;<a href="../asset_pack/AssetPackTraceEvent.html">AssetPackTraceEvent</a>&gt; tracer) <a class="anchor-link" href="#bind"
              title="Permalink to ProgressControler.bind">#</a></h4>
<div class="doc">
<pre class="source">
StreamSubscription bind(Stream&lt;AssetPackTraceEvent&gt; tracer) {
 return tracer.listen(onEvent);
}
</pre>
</div>
</div>
<div class="method"><h4 id="onEvent">
<button class="show-code">Code</button>
void <strong>onEvent</strong>(<a href="../asset_pack/AssetPackTraceEvent.html">AssetPackTraceEvent</a> event) <a class="anchor-link" href="#onEvent"
              title="Permalink to ProgressControler.onEvent">#</a></h4>
<div class="doc">
<pre class="source">
void onEvent(AssetPackTraceEvent event) {
 switch(event.type) {
   case AssetPackTraceEvent.PackImportStart:
     _resetCountersIfEqual();
     _total += 1;
     break;
   case AssetPackTraceEvent.AssetLoadStart:
     _resetCountersIfEqual();
     _total += 2; // load + import
     break;
   case AssetPackTraceEvent.AssetImportStart:
     // ignore already include in load
     break;
   case AssetPackTraceEvent.PackImportEnd:
   case AssetPackTraceEvent.AssetLoadEnd:
   case AssetPackTraceEvent.AssetImportEnd:
     _current += 1;
     break;
 }
 var n = _current/_total;
 _ratio = (displayBackward) ? n : max(_ratio, n);
 if (_pview != null) {
   _pview.value = ease(_ratio, _pview.max, 0).toInt();
 }
 if (_wview != null) {
   _wview.style.width = ease(_ratio, 100, 0).toString() +  "%";
 }
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-06-13 15:38:32.118</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
