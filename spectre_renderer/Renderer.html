        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Renderer class / spectre_renderer Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="spectre_renderer" data-type="Renderer">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../spectre_renderer.html">spectre_renderer</a> &rsaquo; <a href="../spectre_renderer/Renderer.html">Renderer</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>Renderer</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>Spectre Renderer. The renderer holds global GPU resources such as
depth buffers, color buffers, and the canvas front buffer. A renderer
draws the world a layer at a time. A <a class="crossref" href="../spectre_renderer/Layer.html">Layer</a> can render all renderables or
do a full screen scene pass.</p>
<pre class="source">
class Renderer {
 final GraphicsDevice device;
 final DebugDrawManager debugDrawManager;
 final CanvasElement frontBuffer;
 final AssetManager assetManager;
 AssetPack _rendererPack;
 AssetPack _materialShaderPack;
 final Map&lt;String, Texture2D&gt; colorBuffers = new Map&lt;String, Texture2D&gt;();
 final Map&lt;String, RenderBuffer&gt; depthBuffers =
     new Map&lt;String, RenderBuffer&gt;();
 final Map&lt;String, RenderTarget&gt; renderTargets =
     new Map&lt;String, RenderTarget&gt;();
 final Map&lt;String, MaterialShader&gt; materialShaders =
     new Map&lt;String, MaterialShader&gt;();

 SamplerState _renderTargetSampler;
 SamplerState get renderTargetSampler =&gt; _renderTargetSampler;
 Viewport _frontBufferViewport;
 Viewport get frontBufferViewport =&gt; _frontBufferViewport;

 double time = 0.0;

 void _dispose() {
   _rendererPack.clear();
   colorBuffers.forEach((_, t) {
     t.dispose();
   });
   colorBuffers.clear();
   depthBuffers.forEach((_, t) {
     t.dispose();
   });
   depthBuffers.clear();
   renderTargets.forEach((_, t) {
     t.dispose();
   });
   renderTargets.clear();
 }

 void _makeColorBuffer(Map target) {
   String name = target['name'];
   int width = target['width'];
   int height = target['height'];
   if (name == null || width == null || height == null) {
     throw new ArgumentError('Invalid target description.');
   }
   Texture2D buffer = new Texture2D(name, device);
   buffer.uploadPixelArray(width, height, new Uint8List(width*height*4));
   colorBuffers[name] = buffer;
   var asset =
       _rendererPack.registerAsset(name, 'ColorBuffer', '', {}, {});
   asset.imported = buffer;
 }

 void _makeDepthBuffer(Map target) {
   String name = target['name'];
   int width = target['width'];
   int height = target['height'];
   if (name == null || width == null || height == null) {
     throw new ArgumentError('Invalid target description.');
   }
   RenderBuffer buffer = new RenderBuffer(name, device);
   buffer.allocateStorage(width, height, RenderBuffer.FormatDepth);
   depthBuffers[name] = buffer;
   var asset =
       _rendererPack.registerAsset(name, 'DepthBuffer', '',  {}, {});
   asset.imported = buffer;
 }

 void _makeRenderTarget(Map target) {
   // TODO: Support stencil buffers.
   var name = target['name'];
   if (name == null) {
     throw new ArgumentError('Render target requires a name.');
   }
   var colorBufferName = target['colorBuffer'];
   var depthBufferName = target['depthBuffer'];
   var stencilBufferName = target['stencilBuffer'];
   var colorBuffer = colorBuffers[colorBufferName];
   var depthBuffer = depthBuffers[depthBufferName];
   //XXX var stencilBuffer = stencilBuffers[stencilTarget];
   if (colorBuffer == null &amp;&amp; depthBuffer == null) {
     throw new ArgumentError('Render target needs a color or a depth buffer.');
   }
   RenderTarget renderTarget = new RenderTarget(name, device);
   renderTarget.colorTarget = colorBuffer;
   renderTarget.depthTarget = depthBuffer;
   renderTargets[name]= renderTarget;
   var asset = _rendererPack.registerAsset(name, 'RenderTarget', '', {},
                                           {});
   asset.imported = renderTarget;
 }

 void _configureFrontBuffer(Map target) {
   int width = target['width'];
   int height = target['height'];
   if (width == null || height == null) {
     throw new ArgumentError('Invalid front buffer description.');
   }
   frontBuffer.width = width;
   frontBuffer.height = height;
   _frontBufferViewport.width = frontBuffer.width;
   _frontBufferViewport.height = frontBuffer.height;
   renderTargets['frontBuffer'] = RenderTarget.systemRenderTarget;
   if (_rendererPack['frontBuffer'] == null) {
     var asset = _rendererPack.registerAsset('frontBuffer', 'RenderTarget',
                                             '', {}, {});
     asset.imported =  RenderTarget.systemRenderTarget;
   }
 }

 Layer layerFactory(Map layerDescription) {
   String type = layerDescription['type'];
   if (type == null) {
     throw new FormatException('Layer has no type.');
   }
   String name = layerDescription['name'];
   if (name == null) {
     throw new FormatException('Layer has no name.');
   }
   Layer layer;
   switch (type) {
     case 'Fullscreen':
       layer = new FullscreenLayer(name, this);
     break;
     case 'DebugDraw':
       layer = new DebugDrawLayer(name, this);
     break;
     case 'Scene':
       layer = new SceneLayer(name, this);
     break;
     default:
       throw new UnimplementedError('Unknown layer type: $type');
   }
   layer.fromJson(layerDescription, this);
   return layer;
 }

 /// Clear render targets.
 void clear() {
   _dispose();
 }

 void fromJson(Map config) {
   clear();
   List&lt;Map&gt; buffers = config['buffers'];
   List&lt;Map&gt; targets = config['targets'];
   if (buffers != null) {
     buffers.forEach((bufferDescription) {
       if (bufferDescription['type'] == 'color') {
         _makeColorBuffer(bufferDescription);
       } else if (bufferDescription['type'] == 'depth') {
         _makeDepthBuffer(bufferDescription);
       }
     });
   }
   if (targets != null) {
     targets.forEach((target) {
       if (target['name'] == 'frontBuffer') {
         _configureFrontBuffer(target);
       } else {
         _makeRenderTarget(target);
       }
     });
   }
 }

 dynamic toJson() {

 }

 List&lt;Renderable&gt; _determineVisibleSet(List&lt;Renderable&gt; renderables,
                                       Camera camera) {
   if (renderables == null) {
     return null;
   }
   List&lt;Renderable&gt; visibleSet = new List&lt;Renderable&gt;();
   int numRenderables = renderables.length;
   for (int i = 0; i &lt; numRenderables; i++) {
     Renderable renderable = renderables[i];
     bool visible = true; // drawable.visibleTo(camera);
     if (!visible)
       continue;
     visibleSet.add(renderable);
   }
   return visibleSet;
 }

 void _sortDrawables(List&lt;Renderable&gt; visibleSet, int sortMode) {
 }

 void _renderLayer(Layer layer, List&lt;Renderable&gt; renderables, Camera camera) {
   RenderTarget renderTarget = _rendererPack[layer.renderTarget];
   if (renderTarget == null) {
     print('Render target ${layer.renderTarget} cannot be found...');
     print('... skipping ${layer.name}');
     return;
   }
   device.context.setRenderTarget(renderTarget);
   layer.clear();
   layer.render(this, renderables, camera);
 }

 void render(List&lt;Layer&gt; layers, List&lt;Renderable&gt; renderables, Camera camera) {
   frontBufferViewport.width = frontBuffer.width;
   frontBufferViewport.height = frontBuffer.height;
   List&lt;Renderable&gt; visibleSet;
   visibleSet = _determineVisibleSet(renderables, camera);
   final int numLayers = layers.length;
   for (int layerIndex = 0; layerIndex &lt; numLayers; layerIndex++) {
     _renderLayer(layers[layerIndex], visibleSet, camera);
   }
 }

 Renderer(this.frontBuffer, this.device, this.debugDrawManager,
          this.assetManager) {
   _renderTargetSampler = new SamplerState.linearClamp(
       'Renderer.renderTargetSampler',
       device);
   _rendererPack = assetManager.registerPack('renderer', '');
   _materialShaderPack = assetManager.registerPack('materialShaders','');
   _registerBuiltinMaterialShaders(this);
   _frontBufferViewport = new Viewport('Renderer.Viewport', device);
   _frontBufferViewport.width = frontBuffer.width;
   _frontBufferViewport.height = frontBuffer.height;
 }
}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="Renderer">
<button class="show-code">Code</button>
new <strong>Renderer</strong>(CanvasElement frontBuffer, <a href="../spectre/GraphicsDevice.html">GraphicsDevice</a> device, <a href="../spectre/DebugDrawManager.html">DebugDrawManager</a> debugDrawManager, <a href="../asset_pack/AssetManager.html">AssetManager</a> assetManager) <a class="anchor-link" href="#Renderer"
              title="Permalink to Renderer.Renderer">#</a></h4>
<div class="doc">
<pre class="source">
Renderer(this.frontBuffer, this.device, this.debugDrawManager,
        this.assetManager) {
 _renderTargetSampler = new SamplerState.linearClamp(
     'Renderer.renderTargetSampler',
     device);
 _rendererPack = assetManager.registerPack('renderer', '');
 _materialShaderPack = assetManager.registerPack('materialShaders','');
 _registerBuiltinMaterialShaders(this);
 _frontBufferViewport = new Viewport('Renderer.Viewport', device);
 _frontBufferViewport.width = frontBuffer.width;
 _frontBufferViewport.height = frontBuffer.height;
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="assetManager">
<button class="show-code">Code</button>
final <a href="../asset_pack/AssetManager.html">AssetManager</a>         <strong>assetManager</strong> <a class="anchor-link"
            href="#assetManager"
            title="Permalink to Renderer.assetManager">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final AssetManager assetManager
</pre>
</div>
</div>
<div class="field"><h4 id="colorBuffers">
<button class="show-code">Code</button>
final Map&lt;String, <a href="../spectre/Texture2D.html">Texture2D</a>&gt;         <strong>colorBuffers</strong> <a class="anchor-link"
            href="#colorBuffers"
            title="Permalink to Renderer.colorBuffers">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final Map&lt;String, Texture2D&gt; colorBuffers = new Map&lt;String, Texture2D&gt;()
</pre>
</div>
</div>
<div class="field"><h4 id="debugDrawManager">
<button class="show-code">Code</button>
final <a href="../spectre/DebugDrawManager.html">DebugDrawManager</a>         <strong>debugDrawManager</strong> <a class="anchor-link"
            href="#debugDrawManager"
            title="Permalink to Renderer.debugDrawManager">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final DebugDrawManager debugDrawManager
</pre>
</div>
</div>
<div class="field"><h4 id="depthBuffers">
<button class="show-code">Code</button>
final Map&lt;String, <a href="../spectre/RenderBuffer.html">RenderBuffer</a>&gt;         <strong>depthBuffers</strong> <a class="anchor-link"
            href="#depthBuffers"
            title="Permalink to Renderer.depthBuffers">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final Map&lt;String, RenderBuffer&gt; depthBuffers =
   new Map&lt;String, RenderBuffer&gt;()
</pre>
</div>
</div>
<div class="field"><h4 id="device">
<button class="show-code">Code</button>
final <a href="../spectre/GraphicsDevice.html">GraphicsDevice</a>         <strong>device</strong> <a class="anchor-link"
            href="#device"
            title="Permalink to Renderer.device">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final GraphicsDevice device
</pre>
</div>
</div>
<div class="field"><h4 id="frontBuffer">
<button class="show-code">Code</button>
final CanvasElement         <strong>frontBuffer</strong> <a class="anchor-link"
            href="#frontBuffer"
            title="Permalink to Renderer.frontBuffer">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final CanvasElement frontBuffer
</pre>
</div>
</div>
<div class="field"><h4 id="frontBufferViewport">
<button class="show-code">Code</button>
final <a href="../spectre/Viewport.html">Viewport</a>         <strong>frontBufferViewport</strong> <a class="anchor-link"
            href="#frontBufferViewport"
            title="Permalink to Renderer.frontBufferViewport">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Viewport get frontBufferViewport =&gt; _frontBufferViewport;
</pre>
</div>
</div>
<div class="field"><h4 id="materialShaders">
<button class="show-code">Code</button>
final Map&lt;String, <a href="../spectre_renderer/MaterialShader.html">MaterialShader</a>&gt;         <strong>materialShaders</strong> <a class="anchor-link"
            href="#materialShaders"
            title="Permalink to Renderer.materialShaders">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final Map&lt;String, MaterialShader&gt; materialShaders =
   new Map&lt;String, MaterialShader&gt;()
</pre>
</div>
</div>
<div class="field"><h4 id="renderTargets">
<button class="show-code">Code</button>
final Map&lt;String, <a href="../spectre/RenderTarget.html">RenderTarget</a>&gt;         <strong>renderTargets</strong> <a class="anchor-link"
            href="#renderTargets"
            title="Permalink to Renderer.renderTargets">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final Map&lt;String, RenderTarget&gt; renderTargets =
   new Map&lt;String, RenderTarget&gt;()
</pre>
</div>
</div>
<div class="field"><h4 id="renderTargetSampler">
<button class="show-code">Code</button>
final <a href="../spectre/SamplerState.html">SamplerState</a>         <strong>renderTargetSampler</strong> <a class="anchor-link"
            href="#renderTargetSampler"
            title="Permalink to Renderer.renderTargetSampler">#</a>
        </h4>
        <div class="doc">
<pre class="source">
SamplerState get renderTargetSampler =&gt; _renderTargetSampler;
</pre>
</div>
</div>
<div class="field"><h4 id="time">
<button class="show-code">Code</button>
double         <strong>time</strong> <a class="anchor-link"
            href="#time"
            title="Permalink to Renderer.time">#</a>
        </h4>
        <div class="doc">
<pre class="source">
double time = 0.0
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="clear">
<button class="show-code">Code</button>
void <strong>clear</strong>() <a class="anchor-link" href="#clear"
              title="Permalink to Renderer.clear">#</a></h4>
<div class="doc">
<p>Clear render targets.</p>
<pre class="source">
void clear() {
 _dispose();
}
</pre>
</div>
</div>
<div class="method"><h4 id="fromJson">
<button class="show-code">Code</button>
void <strong>fromJson</strong>(Map config) <a class="anchor-link" href="#fromJson"
              title="Permalink to Renderer.fromJson">#</a></h4>
<div class="doc">
<pre class="source">
void fromJson(Map config) {
 clear();
 List&lt;Map&gt; buffers = config['buffers'];
 List&lt;Map&gt; targets = config['targets'];
 if (buffers != null) {
   buffers.forEach((bufferDescription) {
     if (bufferDescription['type'] == 'color') {
       _makeColorBuffer(bufferDescription);
     } else if (bufferDescription['type'] == 'depth') {
       _makeDepthBuffer(bufferDescription);
     }
   });
 }
 if (targets != null) {
   targets.forEach((target) {
     if (target['name'] == 'frontBuffer') {
       _configureFrontBuffer(target);
     } else {
       _makeRenderTarget(target);
     }
   });
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="layerFactory">
<button class="show-code">Code</button>
<a href="../spectre_renderer/Layer.html">Layer</a> <strong>layerFactory</strong>(Map layerDescription) <a class="anchor-link" href="#layerFactory"
              title="Permalink to Renderer.layerFactory">#</a></h4>
<div class="doc">
<pre class="source">
Layer layerFactory(Map layerDescription) {
 String type = layerDescription['type'];
 if (type == null) {
   throw new FormatException('Layer has no type.');
 }
 String name = layerDescription['name'];
 if (name == null) {
   throw new FormatException('Layer has no name.');
 }
 Layer layer;
 switch (type) {
   case 'Fullscreen':
     layer = new FullscreenLayer(name, this);
   break;
   case 'DebugDraw':
     layer = new DebugDrawLayer(name, this);
   break;
   case 'Scene':
     layer = new SceneLayer(name, this);
   break;
   default:
     throw new UnimplementedError('Unknown layer type: $type');
 }
 layer.fromJson(layerDescription, this);
 return layer;
}
</pre>
</div>
</div>
<div class="method"><h4 id="render">
<button class="show-code">Code</button>
void <strong>render</strong>(List&lt;<a href="../spectre_renderer/Layer.html">Layer</a>&gt; layers, List&lt;<a href="../spectre_renderer/Renderable.html">Renderable</a>&gt; renderables, <a href="../spectre/Camera.html">Camera</a> camera) <a class="anchor-link" href="#render"
              title="Permalink to Renderer.render">#</a></h4>
<div class="doc">
<pre class="source">
void render(List&lt;Layer&gt; layers, List&lt;Renderable&gt; renderables, Camera camera) {
 frontBufferViewport.width = frontBuffer.width;
 frontBufferViewport.height = frontBuffer.height;
 List&lt;Renderable&gt; visibleSet;
 visibleSet = _determineVisibleSet(renderables, camera);
 final int numLayers = layers.length;
 for (int layerIndex = 0; layerIndex &lt; numLayers; layerIndex++) {
   _renderLayer(layers[layerIndex], visibleSet, camera);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="toJson">
<button class="show-code">Code</button>
dynamic <strong>toJson</strong>() <a class="anchor-link" href="#toJson"
              title="Permalink to Renderer.toJson">#</a></h4>
<div class="doc">
<pre class="source">
dynamic toJson() {

}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-06-13 15:38:33.090</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
